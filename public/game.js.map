{"version":3,"file":"game.js","mappings":";;;;;AAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,oDAAoD,QAAQ;AAC5D,gDAAgD,QAAQ;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,MAAM;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,UAAU,IAAI,cAAc,IAAI,eAAe;AAC1F;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,CAAC","sources":["webpack://snake-game/./public/game.ts"],"sourcesContent":["\"use strict\";\nclass SnakeGameClient {\n    constructor() {\n        this.pauseDebounce = false;\n        this.canvas = document.getElementById('gameCanvas');\n        this.ctx = this.canvas.getContext('2d');\n        // Set canvas size\n        this.canvas.width = 400;\n        this.canvas.height = 400;\n        // Game settings\n        this.gridSize = 20;\n        // Initialize UI elements\n        this.scoreElement = document.getElementById('score');\n        this.highScoreElement = document.getElementById('highScore');\n        this.startBtn = document.getElementById('startBtn');\n        this.pauseBtn = document.getElementById('pauseBtn');\n        this.userNameElement = document.getElementById('userName');\n        this.switchUserBtn = document.getElementById('switchUserBtn');\n        this.nameModal = document.getElementById('nameModal');\n        this.nameInput = document.getElementById('nameInput');\n        this.submitNameBtn = document.getElementById('submitNameBtn');\n        this.topScoresBtn = document.getElementById('topScoresBtn');\n        this.topScoresModal = document.getElementById('topScoresModal');\n        this.scoresList = document.getElementById('scoresList');\n        this.closeScoresBtn = document.getElementById('closeScoresBtn');\n        this.upBtn = document.getElementById('upBtn');\n        this.downBtn = document.getElementById('downBtn');\n        this.leftBtn = document.getElementById('leftBtn');\n        this.rightBtn = document.getElementById('rightBtn');\n        // Set up event listeners once\n        this.setupEventListeners();\n        // Load user name\n        this.userName = localStorage.getItem('snakeUserName') || '';\n        if (this.userName) {\n            this.initializeGame();\n        }\n        else {\n            this.showNameModal();\n        }\n    }\n    showNameModal() {\n        this.nameModal.classList.add('show');\n        this.nameInput.focus();\n        this.submitNameBtn.addEventListener('click', () => {\n            this.setUserName();\n        });\n        this.nameInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') {\n                this.setUserName();\n            }\n        });\n    }\n    setUserName() {\n        const name = this.nameInput.value.trim();\n        if (name) {\n            this.userName = name;\n            localStorage.setItem('snakeUserName', this.userName);\n            this.nameModal.classList.remove('show');\n            // Always initialize/reinitialize the game\n            this.initializeGame();\n        }\n    }\n    initializeGame() {\n        // Display user name\n        this.userNameElement.textContent = this.userName;\n        // Connect to server\n        this.socket = io();\n        this.socket.emit('setUserName', this.userName);\n        this.setupSocketListeners();\n    }\n    setupSocketListeners() {\n        this.socket.on('gameState', (state) => {\n            this.render(state);\n        });\n    }\n    setupEventListeners() {\n        document.addEventListener('keydown', this.handleKeyPress.bind(this));\n        this.startBtn.addEventListener('click', () => {\n            this.socket.emit('startGame');\n            this.startBtn.blur();\n        });\n        this.pauseBtn.addEventListener('click', () => {\n            if (this.pauseDebounce) {\n                return;\n            }\n            this.pauseDebounce = true;\n            this.socket.emit('togglePause');\n            this.pauseBtn.blur();\n            setTimeout(() => {\n                this.pauseDebounce = false;\n            }, 300);\n        });\n        this.switchUserBtn.addEventListener('click', () => {\n            this.switchUser();\n        });\n        this.topScoresBtn.addEventListener('click', () => {\n            this.showTopScores();\n        });\n        this.closeScoresBtn.addEventListener('click', () => {\n            this.topScoresModal.classList.remove('show');\n        });\n        // Joystick buttons\n        this.upBtn.addEventListener('click', () => {\n            this.socket.emit('changeDirection', 'up');\n            this.upBtn.blur();\n        });\n        this.downBtn.addEventListener('click', () => {\n            this.socket.emit('changeDirection', 'down');\n            this.downBtn.blur();\n        });\n        this.leftBtn.addEventListener('click', () => {\n            this.socket.emit('changeDirection', 'left');\n            this.leftBtn.blur();\n        });\n        this.rightBtn.addEventListener('click', () => {\n            this.socket.emit('changeDirection', 'right');\n            this.rightBtn.blur();\n        });\n    }\n    switchUser() {\n        // Reload the page for a complete clean slate\n        localStorage.removeItem('snakeUserName');\n        window.location.reload();\n    }\n    handleKeyPress(event) {\n        if (event.key === ' ') {\n            event.preventDefault();\n            if (this.pauseDebounce) {\n                return;\n            }\n            this.pauseDebounce = true;\n            this.socket.emit('togglePause');\n            setTimeout(() => {\n                this.pauseDebounce = false;\n            }, 300);\n            return;\n        }\n        let direction = null;\n        switch (event.key) {\n            case 'ArrowUp':\n                direction = 'up';\n                break;\n            case 'ArrowDown':\n                direction = 'down';\n                break;\n            case 'ArrowLeft':\n                direction = 'left';\n                break;\n            case 'ArrowRight':\n                direction = 'right';\n                break;\n        }\n        if (direction) {\n            this.socket.emit('changeDirection', direction);\n        }\n    }\n    render(state) {\n        this.clearCanvas();\n        this.drawSnake(state.snake);\n        this.drawFood(state.food);\n        this.drawEnemies(state.enemies);\n        this.scoreElement.textContent = state.score.toString();\n        this.highScoreElement.textContent = state.highScore.toString();\n        if (state.gameOver) {\n            this.drawGameOver(state.score);\n            this.startBtn.textContent = 'Play Again';\n            this.pauseBtn.disabled = true;\n        }\n        else {\n            this.startBtn.textContent = 'Restart';\n            this.pauseBtn.disabled = false;\n        }\n        if (state.isPaused) {\n            this.drawPauseOverlay();\n            this.pauseBtn.textContent = 'Resume';\n        }\n        else {\n            this.pauseBtn.textContent = 'Pause';\n        }\n    }\n    clearCanvas() {\n        this.ctx.fillStyle = '#2c3e50';\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n    drawSnake(snake) {\n        this.ctx.fillStyle = '#2ecc71';\n        snake.forEach((segment, index) => {\n            this.ctx.fillRect(segment.x, segment.y, this.gridSize - 2, this.gridSize - 2);\n            // Draw eyes on the head\n            if (index === 0) {\n                this.ctx.fillStyle = '#000';\n                const eyeSize = 4;\n                // Simplified eye drawing - assuming right direction for now\n                this.ctx.fillRect(segment.x + 12, segment.y + 4, eyeSize, eyeSize);\n                this.ctx.fillRect(segment.x + 12, segment.y + 12, eyeSize, eyeSize);\n            }\n        });\n    }\n    drawFood(food) {\n        this.ctx.fillStyle = '#e74c3c';\n        this.ctx.beginPath();\n        this.ctx.arc(food.x + this.gridSize / 2, food.y + this.gridSize / 2, this.gridSize / 2 - 2, 0, Math.PI * 2);\n        this.ctx.fill();\n    }\n    drawEnemies(enemies) {\n        enemies.forEach(enemy => {\n            this.drawSkull(enemy.x, enemy.y, enemy.opacity);\n        });\n    }\n    drawSkull(x, y, opacity) {\n        this.ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;\n        this.ctx.strokeStyle = `rgba(0, 0, 0, ${opacity})`;\n        this.ctx.lineWidth = 1;\n        // Head\n        this.ctx.beginPath();\n        this.ctx.arc(x + this.gridSize / 2, y + this.gridSize / 2, this.gridSize / 2 - 2, 0, Math.PI * 2);\n        this.ctx.fill();\n        // Eyes\n        this.ctx.beginPath();\n        this.ctx.arc(x + this.gridSize / 2 - 4, y + this.gridSize / 2 - 3, 2, 0, Math.PI * 2);\n        this.ctx.fill();\n        this.ctx.beginPath();\n        this.ctx.arc(x + this.gridSize / 2 + 4, y + this.gridSize / 2 - 3, 2, 0, Math.PI * 2);\n        this.ctx.fill();\n        // Mouth (teeth)\n        this.ctx.strokeRect(x + this.gridSize / 2 - 3, y + this.gridSize / 2 + 2, 2, 3);\n        this.ctx.strokeRect(x + this.gridSize / 2 - 1, y + this.gridSize / 2 + 2, 2, 3);\n        this.ctx.strokeRect(x + this.gridSize / 2 + 1, y + this.gridSize / 2 + 2, 2, 3);\n    }\n    drawGameOver(score) {\n        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        this.ctx.fillStyle = '#fff';\n        this.ctx.font = '30px Arial';\n        this.ctx.textAlign = 'center';\n        this.ctx.fillText('Game Over!', this.canvas.width / 2, this.canvas.height / 2 - 20);\n        this.ctx.font = '20px Arial';\n        this.ctx.fillText(`Score: ${score}`, this.canvas.width / 2, this.canvas.height / 2 + 20);\n    }\n    drawPauseOverlay() {\n        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        this.ctx.fillStyle = '#fff';\n        this.ctx.font = 'bold 40px Arial';\n        this.ctx.textAlign = 'center';\n        this.ctx.fillText('PAUSED', this.canvas.width / 2, this.canvas.height / 2);\n    }\n    showTopScores() {\n        fetch('/api/top-scores')\n            .then(response => response.json())\n            .then(data => {\n            this.scoresList.innerHTML = '';\n            data.forEach((user, index) => {\n                const scoreItem = document.createElement('div');\n                scoreItem.className = 'score-item';\n                scoreItem.textContent = `${index + 1}. ${user.username}: ${user.highScore}`;\n                this.scoresList.appendChild(scoreItem);\n            });\n            this.topScoresModal.classList.add('show');\n        })\n            .catch(error => {\n            console.error('Error fetching top scores:', error);\n            alert('Error loading top scores');\n        });\n    }\n}\n// Initialize game when the page loads\nwindow.addEventListener('load', () => {\n    new SnakeGameClient();\n});\n"],"names":[],"ignoreList":[],"sourceRoot":""}